generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Jurusan {
  id           String                   @id @default(cuid())
  nama         String                   @unique
  deskripsi    String
  kode         String                   @unique
  createdAt    DateTime                 @default(now())
  updatedAt    DateTime                 @updatedAt
  icon         String                   @default("ðŸŽ¯")
  isActive     Boolean                  @default(true)
  aiResults    AIRecommendationResult[]
  jobPostings  JobPosting[]
  ppdbEntries  PPDBEntry[]              @relation("PPDBJurusan1")
  ppdb2Entries PPDBEntry[]              @relation("PPDBJurusan2")
  ppdb3Entries PPDBEntry[]              @relation("PPDBJurusan3")
  tracerStudy  TracerStudy[]
}

model User {
  id              String                   @id @default(cuid())
  username        String                   @unique
  email           String                   @unique
  password        String
  fullName        String
  role            UserRole
  phone           String?
  address         String?
  photoUrl        String?
  isActive        Boolean                  @default(true)
  createdAt       DateTime                 @default(now())
  updatedAt       DateTime                 @updatedAt
  aiResults       AIRecommendationResult[]
  jobApplications JobApplication[]
  jobPostings     JobPosting[]
  ppdbEntry       PPDBEntry?
  tracerStudy     TracerStudy?
}

model PPDBEntry {
  id               String     @id @default(cuid())
  registrationNo   String     @unique
  userId           String     @unique
  jurusanId1       String
  jurusanId2       String?
  jurusanId3       String?
  status           PPDBStatus @default(PENDING_VERIFIKASI)
  score            Float?
  nisn             String
  nik              String
  birthDate        DateTime
  birthPlace       String
  parentName       String
  parentPhone      String
  parentAddress    String
  kkFile           String?
  aktaFile         String?
  raportFile       String?
  ijazahFile       String?
  fotoCalonFile    String?
  previousSchool   String
  averageScore     Float
  notes            String?
  verifiedBy       String?
  verifiedAt       DateTime?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  registrationYear Int
  registrationSeq  Int
  jurusan1         Jurusan    @relation("PPDBJurusan1", fields: [jurusanId1], references: [id], onDelete: Cascade)
  jurusan2         Jurusan?   @relation("PPDBJurusan2", fields: [jurusanId2], references: [id])
  jurusan3         Jurusan?   @relation("PPDBJurusan3", fields: [jurusanId3], references: [id])
  user             User       @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model AIRecommendationResult {
  id                String   @id @default(cuid())
  userId            String
  quizScore         Float
  minat             String[]
  kemampuanAkademik Float
  gayaBelajar       String
  citaCitaKarier    String
  preferensiKerja   String
  recommendation1   String
  score1            Float
  reasoning1        String
  recommendation2   String?
  score2            Float?
  reasoning2        String?
  recommendation3   String?
  score3            Float?
  reasoning3        String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  jurusan           Jurusan  @relation(fields: [recommendation1], references: [id], onDelete: Cascade)
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model TracerStudy {
  id             String   @id @default(cuid())
  userId         String   @unique
  jurusanId      String
  tahunLulus     Int
  status         String
  namaPerusahaan String?
  jabatan        String?
  gaji           Float?
  relevansi      String?
  notes          String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  namaInstitusi  String?
  namaUsaha      String?
  jurusan        Jurusan  @relation(fields: [jurusanId], references: [id], onDelete: Cascade)
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model JobPosting {
  id            String           @id @default(cuid())
  perusahaanId  String
  jurusanId     String
  posisi        String
  deskripsi     String
  requirements  String[]
  salary        Float?
  lokasi        String
  tipePekerjaan String
  deadline      DateTime
  isActive      Boolean          @default(true)
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  salaryPeriod  String           @default("per_bulan")
  applications  JobApplication[]
  jurusan       Jurusan          @relation(fields: [jurusanId], references: [id], onDelete: Cascade)
  perusahaan    User             @relation(fields: [perusahaanId], references: [id], onDelete: Cascade)
}

model JobApplication {
  id           String     @id @default(cuid())
  jobPostingId String
  userId       String
  cvFile       String
  coverLetter  String?
  status       String     @default("Pending")
  notes        String?
  appliedAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  jobPosting   JobPosting @relation(fields: [jobPostingId], references: [id], onDelete: Cascade)
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([jobPostingId, userId])
}

model News {
  id        String   @id @default(cuid())
  title     String
  content   String
  slug      String   @unique
  thumbnail String?
  featured  Boolean  @default(false)
  published Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Testimonial {
  id         String   @id @default(cuid())
  nama       String
  posisi     String
  perusahaan String
  tahunLulus String
  testimoni  String
  rating     Int      @default(5)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model SchoolProfile {
  id                String   @id @default(cuid())
  sejarah           String
  visi              String
  misi              String
  tujuan            String
  fasilitas         String[]
  guruJumlah        Int
  siswaJumlah       Int
  photoGaleri       String[]
  phoneNumber       String
  emailSchool       String
  address           String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  deskripsiMitra    String?  @default("Perusahaan ternama")
  deskripsiPrestasi String?  @default("Tingkat nasional & internasional")
  deskripsiSerapan  String?  @default("Alumni tersebar industri")
  deskripsiSiswa    String?  @default("Dari berbagai daerah")
  heroDescription   String?  @default("Persiapkan diri untuk era industri 4.0")
  heroStatistics    String?
  heroSubtitle      String?  @default("Bersama SMK Unggulan")
  heroTitle         String?  @default("Wujudkan Masa Depan Digitalmu")
  mitraIndustri     String?  @default("150+")
  prestasi          String?  @default("50+")
  serapanKerja      String?  @default("95%")
  siswaAktif        String?  @default("1,200+")
  nama              String   @default("SMK Unggulan Digital")
  youtube           String?
  instagram         String?
  logo              String?
}

enum UserRole {
  ADMIN_UTAMA
  ADMIN_PPDB
  ADMIN_BKK
  GURU
  SISWA_AKTIF
  CALON_SISWA
  ALUMNI
  PERUSAHAAN
  PENGUNJUNG
  ADMIN_BERITA
}

enum PPDBStatus {
  PENDING_VERIFIKASI
  VERIFIKASI_LANJUT
  LULUS
  CADANGAN
  DITOLAK
}
